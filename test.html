<html>

<head>
    <meta charset="utf-8">
    <title>D3 Test</title>
</head>
<link rel="stylesheet" type="text/css" href="./SmartTrafficChart.css" />

<body >
    <div id="chart" ></div>
    <button onclick="addData('bar')">AddBar</button>
    <button onclick="addData('line')">AddLine</button>
     <button onclick="addData('area')">AddArea</button>
    <button onclick="addData('spline')">AddSpline</button>
    <button onclick="addData('boxplot')">AddBoxPlot</button>
    <button onclick="capture()">Capture</button>
    <script src="./lib/d3.js" charset="utf-8"></script>
    <script src="./SmartTrafficChart.js" charset="utf-8"></script>
    <script>
        function capture(){
            _c.getPic();
        }
        Array.prototype.unique = function(){
            this.sort(function(v1,v2){return new Date(v1.time)- new Date(v2.time)});	//先排序
            var res = [this[0]];
            for(var i = 1; i < this.length; i++){
                if(this[i].time !== res[res.length - 1].time){
                    res.push(this[i]);
                }
            }
            return res;
        }
        window.onresize=function(e){
          _c.setWidth(document.body.clientWidth);
          _c.setHeight(document.body.clientHeight-100);
        }
        function addData(type) {
            var _data = [],_d1=[];
            for (var i = 0; i < 30; ++i) {
                _data.push({
                    time: "2016-2-3 1:" + 5 * Math.floor(60 * Math.random()) % 60,
                    num: 100 + 100 * Math.random()+i
                });
                var d =100 + 100 * Math.random()+i;
                _d1.push({
                      time: "2016-2-3 1:" + 5 * Math.floor(60 * Math.random()) % 60,
                      d1:d+10,
                      d2:d+5,
                      d3:d,
                      d4:d-10,
                      d5:d-15
                })
            }
            var name = Math.floor(10 * Math.random());
            if(type === "boxplot") {
                   _c.addData({
                id: name,
                "name": "name" + name,
                "data": _d1.unique(),
                option: {
                    type: type,
                    y: "num",
                    x:"time",
                    d1Hint:"最大值",
                    d2Hint:"3/4分位值",
                    d3Hint:"中位值",
                    d4Hint:"1/4分位值",
                    d5Hint:"最小值"
                }
            });
            }else{
                _c.addData({
                            id: name,
                            "name": "name" + name,
                            "data": _data.unique(),
                            option: {
                                type: type,
                                y: "num",
                                x:"time",
                                ref: "y2",
                                yHint:"数量"
                            }
                        });
            }
      
        };
        var _c = SmartTrafficChart.create({
            "width": document.body.clientWidth,
            "height": document.body.clientHeight-100,
            title: "D3测试",
            yTitle: "Y轴标题",
            xTitle: "x轴标题",
            secondTitle: "二级标题测试",
            y2Title: "y2轴标题",
            type:"timeSeries"
        });
        var data = [{
            "y": "152",
            "x": "2016-2-3 1:00"
        }, {
            "y": "189",
            "x": "2016-2-3 1:05"
        }, {
            "y": "179",
            "x": "2016-2-3 1:10"
        }, {
            "y": "199",
            "x": "2016-2-3 1:20"
        }, {
            "y": "134",
            "x": "2016-2-3 1:30"
        }, {
            "y": "176",
            "x": "2016-2-3 1:40"
        }];
        _c.addData({
            "name": "bule",
            id: "no.1",
            "data": data,
            option: {
                type: "line"
            }
        });
        _c.appendTo("chart");
        // _c.addEventHandler("select", function(data) {
        //     console.log(data)
        // });
        // _c.addEventHandler("deSelect", function(data) {
        //     console.log("remove id = " + data.id)
        // });

        // var ws = new WebSocket("ws://127.0.0.1:8123");
        // ws.onopen = function(){ws.send("Test!"); };

        // ws.onmessage = function(evt){
        //     console.log(evt.data);
        //     var data = JSON.parse(evt.data);
        //     _c.addFlowData("flow", {"x":data.time, "y": data.data},{"color":"blue"});
        //     };

        // ws.onclose = function(evt){console.log("WebSocketClosed!");};

        // ws.onerror = function(evt){console.log("WebSocketError!");};
    </script>
</body>

</html>
<html>

<head>
    <meta charset="utf-8">
    <title>D3 Test</title>
</head>
<link rel="stylesheet" type="text/css" href="./SmartTrafficChart.css" />

<body >
    <div id="chart" ></div>
    <button onclick="addData('bar')">AddBar</button>
    <button onclick="addData('line')">AddLine</button>
     <button onclick="addData('area')">AddArea</button>
    <button onclick="addData('spline')">AddSpline</button>
    <button onclick="addData('boxplot')">AddBoxPlot</button>
    <button onclick="capture()">Capture</button>
     <div id="chart2" ></div>
     <button onclick="addData2()">AddRadar</button>
    <button onclick="capture2()">Capture</button>
    <script src="./lib/d3.js" charset="utf-8"></script>
    <script src="./SmartTrafficChart.js" charset="utf-8"></script>
    <script>
        function capture(){
            _c.getPic();
        }
          function capture2(){
            c2.getPic();
        }
        Array.prototype.unique = function(){
            this.sort(function(v1,v2){return new Date(v1.time)- new Date(v2.time)});	//先排序
            var res = [this[0]];
            for(var i = 1; i < this.length; i++){
                if(this[i].time !== res[res.length - 1].time){
                    res.push(this[i]);
                }
            }
            return res;
        }
        function addData(type) {
            var _data = [],_d1=[];
            for (var i = 0; i < 30; ++i) {
                _data.push({
                    time: "2016-2-3 1:" + 5 * Math.floor(60 * Math.random()) % 60,
                    num: 100 + 100 * Math.random()+i
                });
                var d =100 + 100 * Math.random()+i;
                _d1.push({
                      time: "2016-2-3 1:" + 5 * Math.floor(60 * Math.random()) % 60,
                      d0:d+10,
                      d1:d+5,
                      d2:d,
                      d3:d-10,
                      d4:d-15
                })
            }
            var name = Math.floor(10 * Math.random());
            if(type === "boxplot") {
                   _c.addData({
                id: name,
                "name": "name" + name,
                "data": _d1.unique(),
                option: {
                    type: type,
                    y: "num",
                    x:"time"
                }
            });
            }else{
                _c.addData({
                            id: name,
                            "name": "name" + name,
                            "data": _data.unique(),
                            option: {
                                type: type,
                                y: "num",
                                x:"time",
                                ref: "y2",
                                yHint:"数量"
                            }
                        });
            }
      
        };
 function addData2() {
               var _d1={
                      d0:100*Math.random(),
                      d1:100*Math.random(),
                      d2:100*Math.random(),
                      d3:100*Math.random(),
                      d4:100*Math.random()
                };
            var name = Math.floor(10 * Math.random());
                    c2.addData({
                        name:name,
                        id:name,
                        data:_d1,
                        option:{
                            type:"radar"
                        }
                    });
        };
        var _c = SmartTrafficChart.create({
            "width": 1000,
            "height": 800,
            title: "D3测试",
            type:"timeSeries",
            labels:{
                radar:[
                "time",
                "weight",
                "num",
                "acc",
                "Avg"
                ],
                timeseries:{
                    d0Label:"最大值",
                    d1Label:"3/4分位值",
                    d2Label:"中位值",
                    d3Label:"1/4分位值",
                    d4Label:"最小值"
                }
            },
            axis:{
                radar:[
                    "time","w","e","i","g"
                ],
                timeseries:{
                    yTitle: "Y轴标题",
                    xTitle: "x轴标题",
                    y2Title: "y2轴标题",
                }
            }
        });
        var data = [{
            "y": "152",
            "x": "2016-2-3 1:00"
        }, {
            "y": "189",
            "x": "2016-2-3 1:05"
        }, {
            "y": "179",
            "x": "2016-2-3 1:10"
        }, {
            "y": "199",
            "x": "2016-2-3 1:20"
        }, {
            "y": "134",
            "x": "2016-2-3 1:30"
        }, {
            "y": "176",
            "x": "2016-2-3 1:40"
        }];
        _c.addData({
            "name": "bule",
            id: "no.1",
            "data": data,
            option: {
                type: "line"
            }
        });
        _c.appendTo("chart");
        _c.addEventHandler("select", function(data) {
            console.log(data)
        });
        _c.addEventHandler("deSelect", function(data) {
            console.log( data)
        });
         var c2 = SmartTrafficChart.create({
            "width": 1000,
            "height": 800,
            title: "D3测试",
            secondTitle: "二级标题测试",
            type:"radar",
            labels:{
                radar:[
                {label:"time"},
                {label:"weight"},
                {label:"num"},
                {label:"acc"},
                {label:"Avg"},
                {label:"Acc"}
                ],
                timeseries:{
                    d0Label:"最大值",
                    d1Label:"3/4分位值",
                    d2Label:"中位值",
                    d3Label:"1/4分位值",
                    d4Label:"最小值"
                }
            },
            axis:{
                radar:[
                    "time","w","e","i","g"
                ],
                timeseries:{
                    yTitle: "Y轴标题",
                    xTitle: "x轴标题",
                    y2Title: "y2轴标题",
                }
            }
        });
        c2.addData({
            name:"x",
            id:"no",
            data:{ d0:1,d1:2,d3:5,d4:10},
            option:{
                type:"radar"
            }
        });
        c2.appendTo("chart2");
        // var ws = new WebSocket("ws://127.0.0.1:8123");
        // ws.onopen = function(){ws.send("Test!"); };

        // ws.onmessage = function(evt){
        //     console.log(evt.data);
        //     var data = JSON.parse(evt.data);
        //     _c.addFlowData("flow", {"x":data.time, "y": data.data},{"color":"blue"});
        //     };

        // ws.onclose = function(evt){console.log("WebSocketClosed!");};

        // ws.onerror = function(evt){console.log("WebSocketError!");};
    </script>
</body>

</html>
<html>

<head>
    <meta charset="utf-8">
    <title>D3 Test2</title>
</head>
<link rel="stylesheet" type="text/css" href="./chart.css" />

<body >
    <div id="chart" ></div>
    <button onclick="addData('bar')">AddBar</button>
    <button onclick="addData('line')">AddLine</button>
    <button onclick="addData('boxplot')">AddBoxPlot</button>
    <button onclick="removeData()">Remove id 1</button>
    <button onclick="remove()">Remove Chart</button>
    <button onclick="rendering()">Rendering</button>
    <div id="chart2" ></div>
    <button onclick="addData2('bar')">AddBar</button>
    <button onclick="addData2('line')">AddLine</button>
    <button onclick="addData2('boxplot')">AddBoxPlot</button>
     <button onclick="rendering2()">Rendering</button>
    <div id="chart3" ></div>
    <button onclick="addData3('bar')">AddBar</button>
    <button onclick="addData3('boxplot')">AddBoxPlot</button>
     <button onclick="rendering3()">Rendering</button>
    <div id="chart4" ></div>
    <button onclick="addData4()">AddRadar</button>
     <button onclick="rendering4()">Rendering</button>
    <button onclick="capture4()">Capture</button>
    <script src="./lib/d3.js" charset="utf-8"></script>
    <script src="./chart.js" charset="utf-8"></script>
    <script>
        function capture(){
            c1.getPic();
        }
          function capture4(){
            c4.getPic();
        }
        Array.prototype.unique = function(){
            this.sort(function(v1,v2){return new Date(v1.time)- new Date(v2.time)});	//先排序
            var res = [this[0]];
            for(var i = 1; i < this.length; i++){
                if(this[i].time !== res[res.length - 1].time){
                    res.push(this[i]);
                }
            }
            return res;
        }
        Array.prototype.numUnique = function(){
            var res =[];
            for(var i=0;i<this.length; ++i){
                var val =this[i];
                if(res.find(function(v){return  v.num == val.num})=== undefined){
                    res.push(val);
                }
            }
            return res;
        }
        Array.prototype.nameUnique = function(){
            var res =[];
            for(var i=0;i<this.length; ++i){
                var val =this[i];
                if(res.find(function(v){return  v.name == val.name})=== undefined){
                    res.push(val);
                }
            }
            return res;
        }
       
 /////////////////////////////////
   
  var c1 = SmartCompareChart.create();
            c1.setConfig({
            "width": 1000,
            "height": 800,
            title: "TimeSeries",
            xType:"time",
            xTitle:"x",
            yTitle:"y",
            y2Title:"Y2",
            xValueFormat:function(v){
                return d3.time.format("%m月 %d 日 %H:%M")(new Date(v));
            },
            showCustomLine:true
        });
        c1.appendTo("chart");
        function addData(type) {
            var _data = [],_d1=[];_dataNumber=[];
            for (var i = 0; i < 30; ++i) {
                _data.push({
                    time: "2016-2-3 1:" + 5 * Math.floor(60 * Math.random()) % 60,
                    num: 100 + 100 * Math.random()+i
                });
                _dataNumber.push({
                    x: 5 * Math.floor(60 * Math.random()) % 60,
                    num: 100 + 100 * Math.random()+i
                });
                var d =100 + 100 * Math.random()+i;

                _d1.push({
                      time: "2016-2-3 1:" + 5 * Math.floor(60 * Math.random()) % 60,
                      d0:d+10+10*Math.random(),
                      d1:d+5+5*Math.random(),
                      d2:d,
                      d3:d+Math.random(),
                      d4:d-10-5*Math.random(),
                      d5:d-15-10*Math.random()
                })
            }
             _data.push({
                    time: "2016-2-3 1:" + 5 * Math.floor(60 * Math.random()) % 60,
                    num: "N"
                });
            var name = Math.floor(10 * Math.random());
            var measure ;
            if(type==="boxplot"){
                measure= new SmartMeasure({
                            id: name,
                            "name": "name" + name,
                            "data": _d1.unique(),
                            type: type,
                            y: "num",
                            x:"time",
                            legendIcon:"rect",
                            d0Label:"最大值",
                            d1Label:"3/4分位值",
                            d2Label:"中位数",
                            d3Label:"平均值",
                            d4Label:"1/4",
                            d5Label:"最小值"
                        }
            );
            }else{
                measure= new SmartMeasure({
                            id: name,
                            "name": "name" + name,
                            "data": _data.unique(),
                            type: type,
                            y: "num",
                            x:"time",
                            lineWidth:4,
                            dashArray:"2,3",
                            yLabel:"速度"
                        }
            );
            }
           
            c1.addMeasure(measure);
        };
        function removeData(){
            c1.removeMeasureById("1");
        }
        function rendering(){
                c1.rendering();
            }
        function remove(){
            c1.remove();
        }
///////////////////////////
 var c2 = SmartCompareChart.create({
            "width": 1000,
            "height": 800,
            title: "NumberSeries",
            xType:"number",
            xTitle:"x",
            yTitle:"y",
            xValueFormat:function(v){
                return v.toFixed(2);
            },
            appendId:"chart2"
        });
        function addData2(type) {
            var _data = [],_d1=[];_dataNumber=[];
            for (var i = 0; i < 30; ++i) {
                _data.push({
                    num:  5 * Math.floor(60 * Math.random()) % 60,
                    val: 100 + 100 * Math.random()+i
                });
                var d =100 + 100 * Math.random()+i;
                _d1.push({
                      num: 5 * Math.floor(60 * Math.random()) % 60,
                      d0:d+10+10*Math.random(),
                      d1:d+5+5*Math.random(),
                      d2:d,
                      d3:d+Math.random(),
                      d4:d-10-5*Math.random(),
                      d5:d-15-10*Math.random()
                })
            }
             _data.push({
                    num:  5 * Math.floor(60 * Math.random()) % 60,
                    val: "N"
                });
            var name = Math.floor(10 * Math.random());
            var measure ;
            if(type==="boxplot"){
                measure= new SmartMeasure({
                            id: name,
                            name: "name" + name,
                            data: _d1.numUnique(),
                            type: type,
                            x:"num"
                        }
            );
            }else{
                measure= new SmartMeasure({
                            id: name,
                            name: "name" + name,
                            data: _data.numUnique(),
                            type: type,
                            y: "val",
                            x:"num"
                        }
            );
            }
           
            c2.addMeasure(measure);
        };
        function rendering2(){
                c2.rendering();
            }
////////////////////////////
 var c3 = SmartCompareChart.create({
            "width": 1000,
            "height": 800,
            title: "StringSeries",
            xType:"string",
            xTitle:"x",
            yTitle:"y",
            appendId:"chart3",
            showLegend:false
        });
        function addData3(type) {
            var _data = [],_d1=[];_dataNumber=[];
            for (var i = 0; i < 30; ++i) {
                _data.push({
                    name: "Name"+ 5 * Math.floor(60 * Math.random()) % 60,
                    val: 1000 + 100 * Math.random()+i
                });
                var d =100 + 100 * Math.random()+i;
                _d1.push({
                      name: 5 * Math.floor(60 * Math.random()) % 60,
                      d0:d+10+10*Math.random(),
                      d1:d+5+5*Math.random(),
                      d2:d,
                      d3:d+Math.random(),
                      d4:d-10-5*Math.random(),
                      d5:d-15-10*Math.random()
                })
            }
             _data.push({
                    name:  5 * Math.floor(60 * Math.random()) % 60,
                    val: "N"
                });
            var name = Math.floor(10 * Math.random());
            var measure ;
            if(type==="boxplot"){
                measure= new SmartMeasure({
                            id: name,
                            name: "name" + name,
                            data: _d1.nameUnique(),
                            type: type,
                            x:"name",
                            d0Label:"最大值",
                            d1Label:"3/4分位值",
                            d2Label:"中位数",
                            d3Label:"平均值",
                            d4Label:"1/4",
                            d5Label:"最小值"
                        }
            );
            }else{
                measure= new SmartMeasure({
                            id: name,
                            name: "name" + name,
                            data: _data.nameUnique(),
                            type: type,
                            y: "val",
                            x:"name",
                            ref:"y2",
                            lineWidth:4,
                            dashArray:"2,3"
                        }
            );
            }
           
            c3.addMeasure(measure);
        };
        function rendering3(){
                c3.rendering();
            }
/////////////////////////
         var c4 = SmartRadarChart.create({
            "width": 1000,
            "height": 800,
            title: "Radar",
            appendId:"chart4",
            secondTitle: "二级标题测试",
            type:"radar",
            axis: [
                    "time","w","e","i","g"
                ]    
            ,
            valueFormater:function(v){
               return  v.toFixed(2);
            }
        });

   
        function addData4() {
            
            var _d1={
                      d0:100*Math.random(),
                      d1:100*Math.random(),
                      d2:100*Math.random(),
                      d3:100*Math.random(),
                      d4:100*Math.random()
                };
            var name = Math.floor(10 * Math.random());
            var figure=new SmartMeasure({
                        name:name,
                        id:name,
                        data:_d1,
                        type:"radar",
                        valueFormater:function(v){
                            return v.toFixed(3);
                        }
                        
                     });
                    c4.addMeasure(figure);
        };
        function rendering4(){
            c4.rendering();
        }
        // var ws = new WebSocket("ws://127.0.0.1:8123");
        // ws.onopen = function(){ws.send("Test!"); };

        // ws.onmessage = function(evt){
        //     console.log(evt.data);
        //     var data = JSON.parse(evt.data);
        //     _c.addFlowData("flow", {"x":data.time, "y": data.data},{"color":"blue"});
        //     };

        // ws.onclose = function(evt){console.log("WebSocketClosed!");};

        // ws.onerror = function(evt){console.log("WebSocketError!");};
    </script>
</body>

</html>